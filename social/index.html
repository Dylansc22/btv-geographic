<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Burlington Geographic - Physical Maps</title>

<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
<link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.css' rel='stylesheet' />
<link href="//netdna.bootstrapcdn.com/bootswatch/3.1.1/yeti/bootstrap.min.css" rel="stylesheet">

<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
  .leaflet-top-pane {
    pointer-events: none;
  }
</style>
</head>
<body>


<style>
#map-ui {
    position: absolute;
    height:100%;
    right: 0px;
    width:220px;
    margin: 0;
    padding: 0;
    z-index: 100;
    background: rgba(255,255,255,0.6);
}
#layerControls {
    padding: 15px;
}

#locationControls {
    padding: 15px;
}

.btn {
  margin-bottom:4px;
  white-space: normal;
}
</style>

<div id='map-ui'>
    <h2 style="padding:15px;">Social and Economic Patterns</h2>
    <div id='layerControls' class="btn-group-vertical" >
        <h4>Select a Layer:</h4>
    </div>
    <div id='locationControls' class="btn-group-vertical" >
        <h4>Zoom to:</h4>
        <a class='btn btn-info btn-sm' href='#' id="burlington">Burlington City</a>
        <a class='btn btn-info btn-sm' href='#' id="chittenden">Chittenden County</a>
    </div>
</div>
<div id='map'></div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src='http://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.js'></script>
<script src="http://d3js.org/topojson.v1.min.js"></script> 

<script>
var map = L.map('map').setView([44.475, -73.212], 10);

var popup = new L.Popup({ autoPan: false });

var baseLayer = new L.mapbox.tileLayer('landplanner.hl6099hm').addTo(map);

var popdensity = L.geoJson(null,  {
      style: getStyle,
      onEachFeature: onEachFeature
  });

$.getJSON("../geodata/btv_census_blocks_2010.topojson", function (data) {
    var popdensgeojson = topojson.feature(data, data.objects.btv_census_blocks_2010).features;
    popdensity.addData(popdensgeojson);
  });

  function getStyle(feature) {
      return {
          weight: 0,
          opacity: 0,
          fillOpacity: 0.7,
          fillColor: getColor(feature.properties.popdens)
      };
  }

  // get color depending on population density value
  function getColor(d) {
      return d > 18800  ? '#08306b' :
          d > 11400  ? '#3e4d82' :
          d > 7570  ? '#656e9a' :
          d > 5390   ? '#8b90b3' :
          d > 3570   ? '#b1b4cc' :
          d > 860   ? '#d7d9e5' :
          '#ffffff';
  }

  function onEachFeature(feature, layer) {
      layer.on({
          mousemove: mousemove,
          mouseout: mouseout
      });
  }

  var closeTooltip;

  function mousemove(e) {
      var layer = e.target;

      popup.setLatLng(e.latlng);
      popup.setContent('<div class="marker-title">' + layer.feature.properties.name + '</div>' +
          Math.round(layer.feature.properties.popdens) + ' people per square mile');

      if (!popup._map) popup.openOn(map);
      window.clearTimeout(closeTooltip);

      // highlight feature
      layer.setStyle({
          weight: 3,
          color: '#777',
          opacity: 0.9,
          fillOpacity: 0.5
      });

      if (!L.Browser.ie && !L.Browser.opera) {
          layer.bringToFront();
      }
  }

  function mouseout(e) {
      popdensity.resetStyle(e.target);
      closeTooltip = window.setTimeout(function() {
          map.closePopup();
      }, 100);
  }

  /*mapdataviz.legendControl.addLegend(getLegendHTML());

  function getLegendHTML() {
    var grades = [0, 10, 20, 50, 100, 200, 500, 1000],
    labels = [],
    from, to;

    for (var i = 0; i < grades.length; i++) {
      from = grades[i];
      to = grades[i + 1];

      labels.push(
        '<li><span class="swatch" style="background:' + getColor(from + 1) + '"></span> ' +
        from + (to ? '&ndash;' + to : '+')) + '</li>';
    }

    return '<span>People per square mile</span><ul>' + labels.join('') + '</ul>';
  }*/



var city = L.geoJson(null, {
  style: function (feature) {
    return {
      color: "#717276",
      fill: false,
      weight:4,
      opacity: 1,
      clickable: false
    };
  }
});
$.getJSON("../geodata/burlington.topojson", function (data) {
  var citygeojson = topojson.feature(data, data.objects.burlington).features;
  city.addData(citygeojson);
});

var county = L.geoJson(null, {
  style: function (feature) {
    return {
      color: "#94969d",
      fill: false,
      weight:1,
      opacity: 1,
      clickable: false
    };
  }
});
$.getJSON("../geodata/chittenden_towns.topojson", function (data) {
  var countygeojson = topojson.feature(data, data.objects.chittenden_towns).features;
  county.addData(countygeojson);
});
var ui = document.getElementById('layerControls');

addLayer(city, 'City Boundary', 1);
addLayer(county, 'Chittenden County Towns', 2);
addLayer(popdensity, 'Population Density 2010', 3);
addLayer(L.mapbox.tileLayer('landplanner.hm1kg9l2'), 'Building Footprints', 6);
//addLayer(L.tileLayer('https://s3.amazonaws.com/geosprocket/tiles/btv1894-5/{z}/{x}/{y}.png'), 'Selected 1894 Sanborn Maps', 4);

function addLayer(layer, name, zIndex) {
    layer
        .setZIndex(zIndex);

    // Create a simple layer switcher that toggles layers on
    // and off.
    var link = document.createElement('a');

    link.href = '#';
    link.className = 'btn btn-primary btn-sm';
    link.type = 'button';
    link.innerHTML = name;

    link.onclick = function(e) {
        e.preventDefault();
        e.stopPropagation();

        if (map.hasLayer(layer)) {
            map.removeLayer(layer);
            this.className = 'btn btn-primary btn-sm';
        } else {
            map.addLayer(layer);
            this.className = 'active btn btn-primary btn-sm';
        }
    };

    ui.appendChild(link);
}

document.getElementById('burlington').onclick = function() {
     map.setView({ lat: 44.487, lon: -73.226 }, 13);
     return false;
   };
 
document.getElementById('chittenden').onclick = function() {
     map.setView({ lat: 44.434, lon: -73.052 }, 10);
     return false;
   };

// ADD THE REFERENCE OVERLAY
var topPane = L.DomUtil.create('div', 'leaflet-top-pane', map.getPanes().mapPane);
var topLayer = new L.mapbox.tileLayer('landplanner.hl60jemk', {
  maxZoom: 18
}).addTo(map);
topPane.appendChild(topLayer.getContainer());
topLayer.setZIndex(7);
</script>


</body>
</html>